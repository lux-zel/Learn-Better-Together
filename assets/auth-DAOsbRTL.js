import{initializeApp as g}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import{getAuth as f,GithubAuthProvider as h,onAuthStateChanged as w,signInWithEmailAndPassword as I,createUserWithEmailAndPassword as E,sendEmailVerification as b,signOut as P,sendPasswordResetEmail as v}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import{getFirestore as x}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";const B={apiKey:"AIzaSyCLFyJEgzqJw4sSxYoJfaiEklVJp3LTl2g",authDomain:"learn-better-together-21ddd.firebaseapp.com",projectId:"learn-better-together-21ddd",storageBucket:"learn-better-together-21ddd.firebasestorage.app",messagingSenderId:"836724963210",appId:"1:836724963210:web:e3cbec9877d3868534ba73",measurementId:"G-NGZS2PDF69"},y=g(B),i=f(y),R=x(y);new h;const c=new Map,C=6e4,k=5;function l(e){const t=Date.now(),s=(c.get(e)||[]).filter(r=>t-r<C);return s.length>=k?!1:(s.push(t),c.set(e,s),!0)}function d(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=254}function A(e){return e&&e.length>=8}function o(e){return{"auth/email-already-in-use":"Email already in use. Try logging in instead.","auth/invalid-email":"Invalid email address.","auth/weak-password":"Password is too weak.","auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/too-many-requests":"Too many attempts. Please try again later.","auth/operation-not-allowed":"This operation is not allowed.","auth/invalid-credential":"Invalid email or password."}[e.code]||"An error occurred. Please try again."}function n(e,t=!1){const a=document.getElementById("message");a&&(a.textContent=e,a.style.display="block",a.style.backgroundColor=t?"#f8d7da":"#d4edda",a.style.color=t?"#721c24":"#155724",a.style.border=t?"1px solid #f5c6cb":"1px solid #c3e6cb",a.style.padding="10px",a.style.margin="10px 0",a.style.borderRadius="4px",setTimeout(()=>{a.style.display="none"},5e3))}w(i,e=>{if(e){const t=document.getElementById("auth-container"),a=document.getElementById("user-container");t&&(t.style.display="none"),a&&(a.style.display="block");const s=document.getElementById("user-email"),r=document.getElementById("display-email"),u=document.getElementById("email-verified");s&&(s.textContent=m(e.email)),r&&(r.textContent=m(e.email)),u&&(u.textContent=e.emailVerified?"Yes":"No")}else{const t=document.getElementById("auth-container"),a=document.getElementById("user-container");t&&(t.style.display="block"),a&&(a.style.display="none")}});function m(e){const[t,a]=e.split("@");return`${t.slice(0,2)+"*".repeat(Math.max(0,t.length-2))}@${a}`}async function S(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const a=e.value.trim(),s=t.value;if(!a||!s){n("Please enter both email and password",!0);return}if(!d(a)){n("Please enter a valid email address",!0);return}if(!A(s)){n("Password must be at least 8 characters",!0);return}if(!l(`signup_${a}`)){n("Too many signup attempts. Please try again later.",!0);return}try{const r=await E(i,a,s);await b(r.user),n("Account created! Please check your email for verification link."),e.value="",t.value=""}catch(r){n(o(r),!0)}}async function T(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const a=e.value.trim(),s=t.value;if(!a||!s){n("Please enter both email and password",!0);return}if(!d(a)){n("Please enter a valid email address",!0);return}if(!l(`signin_${a}`)){n("Too many login attempts. Please try again later.",!0);return}try{await I(i,a,s),n("Login successful!"),e.value="",t.value=""}catch(r){n(o(r),!0)}}async function _(){try{await P(i),n("Logged out successfully")}catch(e){n(o(e),!0)}}async function z(){const e=document.getElementById("email");let t=e?e.value.trim():"";if(!t&&(t=prompt("Enter your email address:"),!t)){n("Please enter your email address",!0);return}if(!d(t)){n("Please enter a valid email address",!0);return}if(!l(`reset_${t}`)){n("Too many password reset attempts. Please try again later.",!0);return}try{await v(i,t),n("Password reset email sent! Check your inbox.")}catch(a){n(o(a),!0)}}const p=document.getElementById("password");p&&p.addEventListener("keypress",e=>{e.key==="Enter"&&T()});export{T as a,_ as b,i as c,R as d,z as r,S as s};
